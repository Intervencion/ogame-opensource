# Таймеры на JavaScript

В игре широко используются таймеры обратного отсчёта. При этом основной PHP-скрипт возвращает только таймстамп в секундах, сколько осталось до завершения события, 
а дальше организуется вывод значения средствами JavaScript.

## Инстанции

Обработка таймера в разных вариациях находится в следующих модулях:
- /game/js/ocnt.json: Включается в flotten2.php; используется для показа времени САБов. :warning: Работает с замедлением, см. баг ниже.

![ocnt_timer](/imgstore/ocnt_timer.png)

- /game/js/utilities.json: Включается в большую часть страниц. Содержит реализацию t(). :warning: Работает с замедлением, см. баг ниже.
- /game/pages/buildings.php: Очередь постройки флота и обороны. Скрипт интегрирован в HTML. Вроде как не содержит бага с замедлением.
- /game/pages/b_building.php: Очередь постройки зданий. Скрипт интегрирован в HTML; :warning: Работает с замедлением, см. баг ниже.

## Баг замедления таймера

Таймер обратного отсчёта работает медленнее, чем нужно, т.к. счётчик оставшихся секунд уменьшается внутри метода t() (`pp = pp - 1`), в то время как метод `setTimeout` не гарантирует точную генерацию интервалов.
Поэтому с течением времени набегает существенное отставание.

Для исправления, чтобы точно узнать сколько времени прошло, надо проверять таймстамп события каждый раз сравнивая его с реальным временем (now).

#85 

Данное исправление входит в комплект исправленных багов ванильной OGame 0.84
